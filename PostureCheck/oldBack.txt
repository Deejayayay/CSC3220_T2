import * as SQLite from 'expo-sqlite';
import * as FileSystem from "expo-file-system";
import {
	Asset
} from "expo-asset";



let TestVal = 0
let blink = null
let testDb = ["Hello", "Hu"]
let sql
let DB
let dbFile
//https://reactdevstation.github.io/2020/04/04/sqllite.html
//https://forums.expo.dev/t/sqlite-existing-database/6470/3

export async function makeSQLiteDirAsync() {
	const dbTest = SQLite.openDatabase('dummy.db');
   console.log(dbTest)
	try {
		await dbTest.transaction(tx => tx.executeSql(''));
	} catch(e) {
		if (this.state.debugEnabled) console.log('error while executing SQL in dummy DB');
	}
	console.log("me done")
	// return true
}






const createTable = () => new Promise((resolve, reject) => {
	db.transaction(
	  (tx) => {
		// CREATE TABLE IF NOT EXISTS tasks
		//    (id INTEGER PRIMARY KEY AUTOINCREMENT, task TEXT)
		const sqlCmd = `
	 CREATE TABLE IF NOT EXISTS Logger	(
		[Index]    INTEGER PRIMARY KEY AUTOINCREMENT
						   NOT NULL,
		IsDone     INTEGER NOT NULL
						   DEFAULT (0),
		DateDone   NUMERIC NOT NULL
						   DEFAULT (0),
		Difficulty INTEGER DEFAULT (0) 
						   NOT NULL,
		TimeDone   NUMERIC DEFAULT (0) 
						   NOT NULL,
		TypeInfo           REFERENCES TypeStore (Name) 
	)
	CREATE TABLE IF NOT EXISTS TypeStore (
		Name               TEXT    PRIMARY KEY
								   NOT NULL,
		Category           TEXT    DEFAULT Misc
								   NOT NULL,
		Instructions       TEXT,
		[Estimated length] NUMERIC NOT NULL
								   DEFAULT (1),
		Weighting          NUMERIC NOT NULL
								   DEFAULT (1) 
	)
	INSERT INTO TypeStore (
		Name,
		Category,
		Instructions,
		[Estimated length],
		Weighting
	)
	VALUES (
		'No a exersize',
		'Umm',
		'"|Text|Hello world!|Text|Im a new line|Text|Im another line|Text|"',
		30,
		1
	)

INSERT INTO TypeStore (
		Name,
		Category,
		Instructions,
		[Estimated length],
		Weighting
	)
	VALUES (
		'Hello',
		'Me',
		'"|Text|Display|"',
		1,
		1
	)
	  `
		tx.executeSql(sqlCmd);
		DB = tx;
	  },
	  (err) => {
		reject(err);
	  },
	  () => {
		resolve();
	  }
	);
  });




// makeSQLiteDirAsync()
export function loader(){

	// dbFile = SQLite.openDatabase('Test.db');

	// Expo.FileSystem.downloadAsync(
	// 	Expo.Asset.fromModule(require("./AppDatabase.SQLITE")).uri,
	// 	`${Expo.FileSystem.documentDirectory}SQLite/Test.db`
	// )
	// .then(function(){
	
	// 	dbFile = SQLite.openDatabase('Test.db');
	
	// 	// do whatever else you need here
	
	// })
}

// const start = async () => {
// 	try {
// 		// const dbFile =    `${FileSystem.documentDirectory}AppDatabase.SQLITE`;
// 		// const dbFile =    await Asset.loadAsync(require('./assets/adaptive-icon.png'));
// 		// const dbFile =    await Asset.loadAsync(require('./assets/hello.png'));
// 		// const dbFile =    await Asset.loadAsync(require('./AppDatabase.sql'));
// 		// const dbFile =    await Asset.loadAsync(require('./assets/Test.db'));
// 		// const dbFile = "file://Test.db"
// 		// const dbFile = Expo.FileSystem.downloadAsync(
// 		// 	Expo.Asset.fromModule(require('./assets/db/test.db')).uri,
// 		// 	`${Expo.FileSystem.documentDirectory}SQLite/test.db`
// 		// );
// 		const dbFile =    await Asset.loadAsync(require('./assets/AppDatabase.SQLITE'));

// 		const fileExists = await FileSystem.getInfoAsync(dbFile);
// 		console.log(dbFile)
// 		if (!fileExists.exists) {
// 			console.log("Database file does not exist.");
// 			// Handle the situation where the file is not found
// 			return;
// 		}

// 		// DB = SQLite.openDatabase("AppDatabase.SQLITE");
// 		// Rest of your code for working with the database
// 	} catch (error) {
// 		console.log("Error occurred while opening database:", error);
// 		// Handle any other errors that occurred during the process
// 	}
// };


readDataFromTable = () => {
	return new Promise((resolve, reject) => {
		DB.transaction((tx) => {
			// Execute a SELECT query
			tx.executeSql('SELECT * FROM TypeStore', [], (_, {
					rows
				}) => {
					// Extract the rows from the result object
					const data = rows._array;
					resolve(data);
				},
				(_, error) => {
					reject(error);
				});
		});
	});
};


/**
 * makes the timecode 
 * @returns timecode
 */
export function ToTimeCode() {
	let rtnVal = Date().getFullYear + "" + (Date().getMonth + 1) + "" + Date().GetDay
	return rtnVal
}

/**
 * Get the tiem 
 * @param {*} howBack 
 * @returns 
 */
export function GetDaysBack(howBack) {
  //TODO: find caulations for this
	let rtnVal = Date().getFullYear + "" + (Date().getMonth + 1) + "" + Date().GetDay
	return rtnVal
}

/**
 * Open the database
 */
export function Start() {
	// DB =    SQLite.openDatabase("./AppDatabase.db");  
	start()
	// openDatabaseIShipWithApp()
}

/**
 * close the database
 */
export function End() {
	if (DB != null) {
		DB.closeAsync();
	} else {
		console.warn("DATABASE NOT STARTED");
	}
}


/**
 * gets the list of exercise names from table
 * @returns list of names
 */
export function GetExNames() {
	let nameArr = []

	//TODO: Replace with database read
	for (var i = 0; i < 10; i++) {
		nameArr.push("Test_" + i)
	}
	return nameArr
}



export function GetEx(name) {
	rtnArr = []
	//TODO: replace with actual database read
	let testStr = "|Main|Essay #1|Sub|Dylan Beppu|Sub|Wri 1000|Text|\n\tAmerican public schools are a frequent source of debate and conflict. Some people argue that schools do too much, others too little. Historically schools have changed dramatically, from one room schoolhouses to multi service institutions. American public schools have changed a lot in particular, due to American public schools being an extension of the United States government, making them subject to the fluctuations in politics. Due to the connection to the United States government, American public schools change and adapt their curriculum, services, and teaching styles to meet the wants and needs of American citizens.|Text|\tPeople can influence In Sarah Mervosh’s article “In Minneapolis Schools, White Families are asked to help do the integrating”, the state redrew school districts to encourage integration between different races (Mervosh 9). However, the intended integration between people didn’t happen just some school statistics changed yet the school is still segregated. Mervosh interviewed Ms. Friestleben, a principal at a school affected by the redistricting, who wants her students to feel honored and recognized by all, having mixed feelings about the white students being able to recognize their accomplishments (Mervosh 10). Despite some schools in the region being able to integrate well with other ethnicities, some schools such as North High have changed statistically little yet left the community on edge. Racial integration was a failure, however it demonstrates that public schools will adapt to the wants of American citizens, although to what extent and to which group varies.|"
	//name, category, instructions, estimated length
	rtnArr = [name, "Category", testStr, 5]
	return rtnArr
}


/**
 * Gets the exercise image (for making the workout page)
 * @param {*} name 
 * @returns the image name (put the path in the string to image)
 */
export function GetExImg(name) {
	//TODO: Implment
	let imgName = "icon"
	return imgName
}

/**
 * Inset to the exersize array from input
 * @param {*} inArr row to input
 */
export function AddEx(inArr) {

}


//Logs stuffs
export function GetLogs() {

}

export function GetLatest() {
	let rtnTab
	rtnTab.Push()
	return rtnTab
}


/**
 *  Sets the last exercise
 * @param {*} endT end of the exercise (negative is to remove it)
 */
export function SetLatest(endT) {

}

export function GetDay() {

}

export function LogData() {

}



export function TestPass(numbers) {
	console.log(testDb[1])
	console.log("Times called: " + numbers)
	numbers++
}

export function TestGetAll() {
	//TODO: debuggin ish~
	// DB.run('BEGIN TRANSACTION');

	sql = `SELECT Instructions FROM TypeStore`
	// DB.all(sql, [], (err, rows) => {
	//     if (err) return console.error(err.message);
	//     rows.forEach((row) => {
	//         console.log(row);
	//     });
	// })
	// let out = ""
	// DB.transaction((tx) => {
	//     tx.executeSql(sql, [], (tx, result) => {
	//       out = result.rows; // Assuming result.rows contains the retrieved data
	//       console.log(out); // Log the data after it has been retrieved
	//     });
	//   });

	readDataFromTable()
		.then((data) => {
			console.log('Data:', data);
		})
		.catch((error) => {
			console.error('Error:', error);
		});

	// DB.transaction(tx => {
	//     tx.executeSql(
	//         `SELECT Name FROM TypeStore`,
	//         [],
	//         (sqlTxn, res) => {
	//             console.log("found data")
	//         },
	//         error => {
	//             console.log("database error: " + error.message)
	//         }

	//         // out,
	//      );
	// });
	// console.log(out)
}